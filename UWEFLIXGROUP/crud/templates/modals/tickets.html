<div class="modal fade" id="chooseTicketModal" tabindex="-1" aria-labelledby="chooseTicketModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title fs-5" id="chooseTicketModalLabel">Choose Number of Tickets for the Film </h2>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">

      <div class="form-group">
          <label for="adultquantity">Adult Tickets: {{ tickets.ticket_price }}</label>
          <input type="number" id = "adultquantity" min = "1" max = "10" name="tickets.ticketquantity" class="form-control">
        </div>

      <div class="form-group">
          <label for="childquantity">Child Tickets: {{ tickets.ticket_price }}</label>
          <input type="number" id = "childquantity" min = "1" max = "10" name="tickets.ticketquantity" class="form-control">
        </div>

      {% comment %} <div class="form-group">
          <label for="studentquantity">Student Tickets: {{ tickets.ticket_price }}</label>
          <input type="number" id = "studentquantity" min = "1" max = "10" name="tickets.ticketquantity" class="form-control">
        </div> {% endcomment %}

      <div class="form-group">
          <label for="clubquantity">Club Tickets for Club Repersentatives only: {{ tickets.ticket_price }}</label>
          <input type="number" id = "clubquantity" min = "10" name="tickets.ticketquantity" class="form-control">
        </div>

        <div class="form-group">
          <label for="customerdiscount"> Valid Discounts </label>
          <input type= "text" id = "customerdiscount" maxlength = "10" name="" class="form-control">
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Proceed to Checkout</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.querySelector("#chooseTicketModal button.btn-primary").addEventListener("click", function(event) {
    // Get the values of the ticket quantity fields
    var adultQuantity = document.querySelector("#chooseTicketModal input[name='tickets.ticketquantity'][id='adultquantity']").value;
    var childQuantity = document.querySelector("#chooseTicketModal input[name='tickets.ticketquantity'][id='childquantity']").value;
    var studentQuantity = document.querySelector("#chooseTicketModal input[name='tickets.ticketquantity'][id='studentquantity']").value;
    var clubQuantity = document.querySelector("#chooseTicketModal input[name='tickets.ticketquantity'][id='clubquantity']").value;

    // Check if at least one ticket type has a non-zero quantity
    if (adultQuantity == 0 && childQuantity == 0 && studentQuantity == 0 && clubQuantity == 0) {
      alert("Please select at least one type of ticket.");
      event.preventDefault(); // Prevent the form from submitting
    } else{
      window.location.href = "payment.html";
    }
    // get the input elements for each ticket type and discount
    const adultTickets = document.getElementById("quantity");
    const childTickets = document.getElementsByName("tickets.ticketquantity")[0];
    const studentTickets = document.getElementsByName(".ticketquantity")[0];
    const clubTickets = document.getElementsByName("tickets.ticketquantity")[1];
    const discountInput = document.getElementById("customerdiscount");

    // get the ticket prices and discount rate
    const adultPrice = parseFloat("{{ tickets.ticket_price }}");
    const childPrice = parseFloat("{{ tickets.ticket_price }}");
    const studentPrice = parseFloat("{{ tickets.ticket_price }}");
    const clubPrice = parseFloat("{{ tickets.ticket_price }}");
    const discountRate = 0.0; // default value for no discount

    // set up event listener for the checkout button
    const checkoutButton = document.querySelector(".btn-primary");
    checkoutButton.addEventListener("click", function() {
      // calculate the total price for each ticket type
      const adultTotal = adultTickets.value * adultPrice;
      const childTotal = childTickets.value * childPrice;
      const studentTotal = studentTickets.value * studentPrice;
      const clubTotal = clubTickets.value * clubPrice;

      // calculate the total price before discount
      const totalBeforeDiscount = adultTotal + childTotal + studentTotal + clubTotal;

      // get the discount rate from the input, if any
      const discountText = discountInput.value;
      if (discountText !== "") {
        discountRate = parseFloat(discountText);
      }

      // calculate the discount amount and total price after discount
      const discountAmount = totalBeforeDiscount * discountRate;
      const totalAfterDiscount = totalBeforeDiscount - discountAmount;

      // display the total price after discount to the user
      alert(`Total price after discount: $${totalAfterDiscount.toFixed(2)}`);
    });
  });
</script>